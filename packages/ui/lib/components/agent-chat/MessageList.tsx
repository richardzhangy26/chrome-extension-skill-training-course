import { useRef, useEffect } from 'react';
import { MessageBubble, type MessageBubbleProps } from './MessageBubble.js';
import { cn } from '../../utils.js';

export interface Message extends MessageBubbleProps {
  id: string;
}

export interface MessageListProps {
  messages: Message[];
  isLoading?: boolean;
  className?: string;
}

export function MessageList({ messages, isLoading = false, className }: MessageListProps) {
  const containerRef = useRef<HTMLDivElement>(null);
  const bottomRef = useRef<HTMLDivElement>(null);

  // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
  useEffect(() => {
    bottomRef.current?.scrollIntoView({ behavior: 'smooth' });
  }, [messages.length]);

  return (
    <div ref={containerRef} className={cn('flex-1 overflow-y-auto p-4 bg-gray-50', className)}>
      {messages.length === 0 ? (
        <div className="flex flex-col items-center justify-center h-full text-gray-400">
          <div className="text-4xl mb-2">ğŸ’¬</div>
          <div className="text-sm">æš‚æ— æ¶ˆæ¯</div>
          <div className="text-xs mt-1">ç‚¹å‡»å¼€å§‹æŒ‰é’®å¼€å¯å¯¹è¯</div>
        </div>
      ) : (
        <>
          {messages.map(message => (
            <MessageBubble
              key={message.id}
              role={message.role}
              content={message.content}
              timestamp={message.timestamp}
              isAutoGenerated={message.isAutoGenerated}
            />
          ))}

          {/* åŠ è½½æŒ‡ç¤ºå™¨ */}
          {isLoading && (
            <div className="flex justify-start mb-3">
              <div className="bg-white border border-gray-200 rounded-2xl rounded-bl-md px-4 py-3 shadow-sm">
                <div className="flex items-center gap-1">
                  <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '0ms' }} />
                  <div
                    className="w-2 h-2 bg-gray-400 rounded-full animate-bounce"
                    style={{ animationDelay: '150ms' }}
                  />
                  <div
                    className="w-2 h-2 bg-gray-400 rounded-full animate-bounce"
                    style={{ animationDelay: '300ms' }}
                  />
                </div>
              </div>
            </div>
          )}
        </>
      )}

      {/* æ»šåŠ¨é”šç‚¹ */}
      <div ref={bottomRef} />
    </div>
  );
}
